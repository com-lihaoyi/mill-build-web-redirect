<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Java Module Configuration :: Mill</title>
    <link rel="canonical" href="https://mill-build.org/mill/Java_Module_Config.html" />
    <link rel="prev" href="Java_Build_Examples.html" />
    <link rel="next" href="Java_Web_Build_Examples.html" />
    <meta name="generator" content="Antora 3.1.9" />
    <link rel="stylesheet" href="../../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon" />
  
  </head><body class="article">
  
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" />Â Mill</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">Source Code (GitHub)</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>
        <a class="navbar-item" href="https://gitter.im/lihaoyi/mill">Chat</a>

            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="0.11.10">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Scala Quick Start</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Intro_to_Mill_for_Scala.html">Introduction to Mill for Scala</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Build_Examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Module_Config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Web_Build_Examples.html">Web Build Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Java Quick Start</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Intro_to_Mill_for_Java.html">Introduction to Mill for Java</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Build_Examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="Java_Module_Config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Web_Build_Examples.html">Web Build Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Library_Dependencies.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Out_Dir.html">The Output Directory</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Tasks.html">Tasks</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Target_Query_Syntax.html">Target Query Syntax</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Extending_Mill.html">Extending Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="The_Mill_Evaluation_Model.html">The Mill Evaluation Model</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill Plugins</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Using_Plugins.html">Using Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Contrib_Plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bloop.html">Bloop</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Plugin_BSP.html">BSP - Build Server Protocol</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Thirdparty_Plugins.html">Third-Party Plugins</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Mill_Design_Principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="External_References.html">External References</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill/index.html">Mill Scaladoc</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.11.10</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../index.html">0.11.11-8-f908fc</a>
        </li>
        <li class="version is-current">
          <a href="index.html">0.11.10</a>
        </li>
        <li class="version">
          <a href="../0.11.0-M7/index.html">0.11.0-M7</a>
        </li>
        <li class="version">
          <a href="../0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="../0.10.12/index.html">0.10.12</a>
        </li>
        <li class="version">
          <a href="../0.10.0/index.html">0.10.0</a>
        </li>
        <li class="version">
          <a href="../0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../Java_Intro_to_Mill.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Mill Documentation</a></li>
    <li>Java Quick Start</li>
    <li><a href="Java_Module_Config.html">Java Module Configuration</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.11.10</button>
  <div class="version-menu">
    <a class="version" href="../Java_Module_Config.html">0.11.11-8-f908fc</a>
    <a class="version is-current" href="Java_Module_Config.html">0.11.10</a>
    <a class="version is-missing" href="../0.11.0-M7/index.html">0.11.0-M7</a>
    <a class="version is-missing" href="../0.10.15/index.html">0.10.15</a>
    <a class="version is-missing" href="../0.10.12/index.html">0.10.12</a>
    <a class="version is-missing" href="../0.10.0/index.html">0.10.0</a>
    <a class="version is-missing" href="../0.9.12/index.html">0.9.12</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/out/docs/oldDocSources.dest/0.11.10/out/docs/source.dest/modules/ROOT/pages/Java_Module_Config.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Java Module Configuration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page goes into more detail about the various configuration options
for <code>JavaModule</code>.</p>
</div>
<div class="paragraph">
<p>Many of the APIs covered here are listed in the API documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/JavaModule.html">mill.scalalib.JavaModule</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compilation_execution_flags"><a class="anchor" href="#_compilation_execution_flags"></a>Compilation &amp; Execution Flags</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-1-compilation-execution-flags.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/1-compilation-execution-flags">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends RootModule with JavaModule{
  def forkArgs = Seq(&quot;-Xmx4g&quot;, &quot;-Dmy.jvm.property=hello&quot;)
  def forkEnv = Map(&quot;MY_ENV_VAR&quot; -&gt; &quot;WORLD&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default,
<code>run</code> runs the compiled code in a subprocess, and you can pass in JVM flags
via <code>forkArgs</code> or environment-variables via <code>forkEnv</code>.</p>
</div>
<div class="paragraph">
<p>You can also run your code via</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill foo.runLocal</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which runs it in-process within an isolated classloader. This may be faster
since you avoid the JVM startup, but does not support <code>forkArgs</code> or <code>forkEnv</code>.</p>
</div>
<div class="paragraph">
<p>If you want to pass main-method arguments to <code>run</code> or <code>runLocal</code>, simply pass
them after the <code>foo.run</code>/<code>foo.runLocal</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mill foo.run arg1 arg2 arg3
mill foo.runLocal arg1 arg2 arg3</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill run
hello WORLD</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_ivy_dependencies"><a class="anchor" href="#_adding_ivy_dependencies"></a>Adding Ivy Dependencies</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-2-ivy-deps.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/2-ivy-deps">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends RootModule with JavaModule {
  def ivyDeps = Agg(
    ivy&quot;com.fasterxml.jackson.core:jackson-databind:2.13.4&quot;,
  )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define the <code>ivyDeps</code> field to add ivy dependencies to your module.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Single <code>:</code> syntax (e.g. <code>&quot;ivy&quot;org.testng:testng:6.11&quot;</code>) defines Java
dependencies</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To select the test-jars from a dependency use the following syntax:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ivy&quot;org.apache.spark::spark-sql:2.4.0;classifier=tests</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please consult the <a href="Library_Dependencies.html" class="xref page">Library Dependencies in Mill</a> section for even more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill run i am cow
JSONified using Jackson: [&quot;i&quot;,&quot;am&quot;,&quot;cow&quot;]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_runtime_and_compile_time_dependencies"><a class="anchor" href="#_runtime_and_compile_time_dependencies"></a>Runtime and Compile-time Dependencies</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-3-run-compile-deps.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/3-run-compile-deps">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends JavaModule {
  def moduleDeps = Seq(bar)
  def runIvyDeps = Agg(
    ivy&quot;javax.servlet:servlet-api:2.5&quot;,
    ivy&quot;org.eclipse.jetty:jetty-server:9.4.42.v20210604&quot;,
    ivy&quot;org.eclipse.jetty:jetty-servlet:9.4.42.v20210604&quot;
  )
  def mainClass = Some(&quot;bar.Bar&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also declare compile-time-only dependencies with <code>compileIvyDeps</code>.
These are present in the compile classpath, but will not propagated to the
transitive dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object bar extends JavaModule {
  def compileIvyDeps = Agg(
    ivy&quot;javax.servlet:servlet-api:2.5&quot;,
    ivy&quot;org.eclipse.jetty:jetty-server:9.4.42.v20210604&quot;,
    ivy&quot;org.eclipse.jetty:jetty-servlet:9.4.42.v20210604&quot;
  )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically, Mill assumes that a module with compile-time dependencies will
only be run after someone includes the equivalent run-time dependencies in
a later build step. e.g. in the case above, <code>bar</code> defines the compile-time
dependencies, and <code>foo</code> then depends on <code>bar</code> and includes the runtime
dependencies. That is why we can run <code>foo</code> as show below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill foo.runBackground

&gt; curl http://localhost:8079
&lt;html&gt;&lt;body&gt;Hello World!&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Compile-time dependencies are translated to <code>provided</code>-scoped
dependencies when publish to Maven or Ivy-Repositories.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_dependencies"><a class="anchor" href="#_test_dependencies"></a>Test Dependencies</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-4-test-deps.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/4-test-deps">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object qux extends JavaModule {
  def moduleDeps = Seq(baz)

  object test extends JavaTests with TestModule.Junit4 {
    def moduleDeps = super.moduleDeps ++ Seq(baz.test)
  }
}


object baz extends JavaModule {
  object test extends JavaTests with TestModule.Junit4
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, not only does <code>qux</code> depend on <code>baz</code>, but we also make
<code>qux.test</code> depend on <code>baz.test</code>. That lets <code>qux.test</code> make use of the
<code>BazTestUtils</code> class that <code>baz.test</code> defines, allowing us to re-use this
test helper throughout multiple modules' test suites</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill qux.test
Using BazTestUtils.bazAssertEquals
... qux.QuxTests.simple ...
...

&gt; ./mill baz.test
Using BazTestUtils.bazAssertEquals
... baz.BazTests.simple ...
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javadoc_config"><a class="anchor" href="#_javadoc_config"></a>Javadoc Config</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-6-docjar.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/6-docjar">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends JavaModule {
  def javadocOptions = Seq(&quot;-quiet&quot;)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill show foo.docJar

&gt; unzip -p out/foo/docJar.dest/out.jar foo/Foo.html
...
...My Awesome Docs for class Foo...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_unmanaged_jars"><a class="anchor" href="#_unmanaged_jars"></a>Unmanaged Jars</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-7-unmanaged-jars.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/7-unmanaged-jars">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends RootModule with JavaModule {
  def unmanagedClasspath = T {
    if (!os.exists(millSourcePath / &quot;lib&quot;)) Agg()
    else Agg.from(os.list(millSourcePath / &quot;lib&quot;).map(PathRef(_)))
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override <code>unmanagedClasspath</code> to point it at any jars you place on the
filesystem, e.g. in the above snippet any jars that happen to live in the
<code>lib/</code> folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill run '{&quot;name&quot;:&quot;John&quot;,&quot;age&quot;:30}'     # mac/linux
Key: name, Value: John
Key: age, Value: 30</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifying_the_main_class"><a class="anchor" href="#_specifying_the_main_class"></a>Specifying the Main Class</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-8-main-class.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/8-main-class">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends RootModule with JavaModule {
  def mainClass = Some(&quot;foo.Qux&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Millâs <code>foo.run</code> by default will discover which main class to run from your
compilation output, but if there is more than one or the main class comes from
some library you can explicitly specify which one to use. This also adds the
main class to your <code>foo.jar</code> and <code>foo.assembly</code> jars.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill run
Hello Qux</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_downloading_non_maven_jars"><a class="anchor" href="#_downloading_non_maven_jars"></a>Downloading Non-Maven Jars</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-9-downloading-non-maven-jars.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/9-downloading-non-maven-jars">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._

object foo extends RootModule with JavaModule {
  def unmanagedClasspath = T {
    os.write(
      T.dest / &quot;fastjavaio.jar&quot;,
      requests.get.stream(
        &quot;https://github.com/williamfiset/FastJavaIO/releases/download/1.1/fastjavaio.jar&quot;
      )
    )
    Agg(PathRef(T.dest / &quot;fastjavaio.jar&quot;))
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also override <code>unmanagedClasspath</code> to point it at jars that you want to
download from arbitrary URLs. Note that targets like <code>unmanagedClasspath</code> are
cached, so your jar is downloaded only once and re-used indefinitely after that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill run &quot;textfile.txt&quot; # mac/linux
I am cow
hear me moo
I weigh twice as much as you</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_assembly"><a class="anchor" href="#_customizing_the_assembly"></a>Customizing the Assembly</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-10-assembly-config.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/10-assembly-config">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._
import mill.javalib.Assembly._

object foo extends JavaModule {
  def moduleDeps = Seq(bar)
  def assemblyRules = Seq(
    // all application.conf files will be concatenated into single file
    Rule.Append(&quot;application.conf&quot;),
    // all *.conf files will be concatenated into single file
    Rule.AppendPattern(&quot;.*\\.conf&quot;),
    // all *.temp files will be excluded from a final jar
    Rule.ExcludePattern(&quot;.*\\.temp&quot;),
    // the `shapeless` package will be shaded under the `shade` package
    Rule.Relocate(&quot;shapeless.**&quot;, &quot;shade.shapless.@1&quot;)
  )
}

object bar extends JavaModule {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you make a runnable jar of your project with <code>assembly</code> command,
you may want to exclude some files from a final jar (like signature files,
and manifest files from library jars), and merge duplicated files (for
instance <code>reference.conf</code> files from library dependencies).</p>
</div>
<div class="paragraph">
<p>By default mill excludes all <code>*.sf</code>, <code>*.dsa</code>, <code>*.rsa</code>, and
<code>META-INF/MANIFEST.MF</code> files from assembly, and concatenates all
<code>reference.conf</code> files. You can also define your own merge/exclude rules.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill foo.assembly

&gt; unzip -p ./out/foo/assembly.dest/out.jar application.conf
Bar Application Conf
Foo Application Conf

&gt; java -jar ./out/foo/assembly.dest/out.jar\
Loaded application.conf from resources:...
...Foo Application Conf
...Bar Application Conf</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repository_config"><a class="anchor" href="#_repository_config"></a>Repository Config</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.sc (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.11.11/0.11.10-example-javamodule-11-repository-config.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/main//example/javamodule/11-repository-config">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">import mill._, javalib._
import mill.define.ModuleRef
import coursier.maven.MavenRepository

val sonatypeReleases = Seq(
  MavenRepository(&quot;https://oss.sonatype.org/content/repositories/releases&quot;)
)

object foo extends JavaModule {

  def ivyDeps = Agg(
    ivy&quot;net.sourceforge.argparse4j:argparse4j:0.9.0&quot;,
    ivy&quot;org.apache.commons:commons-text:1.12.0&quot;
  )

  def repositoriesTask = T.task { super.repositoriesTask() ++ sonatypeReleases }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill read <a href="https://get-coursier.io/">coursier</a> config files automatically.</p>
</div>
<div class="paragraph">
<p>It is possible to setup mirror with <code>mirror.properties</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">central.from=https://repo1.maven.org/maven2
central.to=http://example.com:8080/nexus/content/groups/public</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note theses default config file locatations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Linux: <code>~/.config/coursier/mirror.properties</code></p>
</li>
<li>
<p>MacOS: <code>~/Library/Preferences/Coursier/mirror.properties</code></p>
</li>
<li>
<p>Windows: <code>C:\Users\&lt;user_name&gt;\AppData\Roaming\Coursier\config\mirror.properties</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also set the environment variable <code>COURSIER_MIRRORS</code> or the jvm property <code>coursier.mirrors</code> to specify config file location.</p>
</div>
<div class="paragraph">
<p>To add custom resolvers to the initial bootstrap of the build, you can create a
custom <code>ZincWorkerModule</code>, and override the <code>zincWorker</code> method in your
<code>ScalaModule</code> by pointing it to that custom object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object CustomZincWorkerModule extends ZincWorkerModule with CoursierModule {
  def repositoriesTask = T.task { super.repositoriesTask() ++ sonatypeReleases }
}

object bar extends JavaModule {
  def zincWorker = ModuleRef(CustomZincWorkerModule)
  // ... rest of your build definitions

  def repositoriesTask = T.task { super.repositoriesTask() ++ sonatypeReleases }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill foo.run --text hello

&gt; ./mill bar.compile</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maven_central_blocked"><a class="anchor" href="#_maven_central_blocked"></a>Maven Central: Blocked!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Under some circumstances (e.g. corporate firewalls), you may not have access maven central. The typical symptom will be error messages which look like this;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1 targets failed
mill.scalalib.ZincWorkerModule.classpath
Resolution failed for 1 modules:
--------------------------------------------
  com.lihaoyi:mill-scalalib-worker_2.13:0.11.1
        not found: C:\Users\partens\.ivy2\local\com.lihaoyi\mill-scalalib-worker_2.13\0.11.1\ivys\ivy.xml
        download error: Caught java.io.IOException (Server returned HTTP response code: 503 for URL: https://repo1.maven.org/maven2/com/lihaoyi/mill-scalalib-worker_2.13/0.11.1/mill-scalalib-worker_2.13-0.11.1.pom) while downloading https://repo1.maven.org/maven2/com/lihaoyi/mill-scalalib-worker_2.13/0.11.1/mill-scalalib-worker_2.13-0.11.1.pom</pre>
</div>
</div>
<div class="paragraph">
<p>It is expected that basic commands (e.g. clean) will not work, as Mill saying it is unable to resolve itâs own, fundamental, dependencies. Under such circumstances, you will normally have access to some proxy, or other corporate repository which resolves maven artefacts. The strategy is simply to tell mill to use that instead.</p>
</div>
<div class="paragraph">
<p>The idea is to set an environment variable COURSIER_REPOSITORIES (see coursier docs). The below command should set the environment variable for the current shell, and then run the mill command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre> COURSIER_REPOSITORIES=https://packages.corp.com/artifactory/maven/ mill resolve _</pre>
</div>
</div>
<div class="paragraph">
<p>If you are using millw, a more permanent solution could be to set the environment variable at the top of the millw script, or as a user environment variable etc.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="Java_Build_Examples.html">Java Build Examples</a></span>
  <span class="next"><a href="Java_Web_Build_Examples.html">Web Build Examples</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async="async" src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async="async" src="../../search-index.js"></script>
  
</body></html>